
# Courial API Doc

## Building Integrations with Courial as Client 
To build integrations with Courial as a client, you should consume this REST API.
This API will be used for requesting deliveries.


### Typical Flow for Delivery Processing
    1. Request a Quote (Optional): This will tell you estimated pickup time and cost for your delivery.
    2. Request a Delivery.
    3. Reschedule, Modify, or Cancel the Delivery.
    4. The Delivery is Executed.

### Webhooks
You can receive updates about a delivery by subscribing to [webhooks](#api-webhooks-100).

### Authorization
Clients will authenticate themselves by presenting a Bearer token in the request header.

clients should get the following keys from us:

- Developer ID
- Client ID
- Client Secret

Clients will use these keys to generate a JWT, and every request to API will contain the JWT token in the header.
Courial API will use JWTs to authenticate users before allowing them to access the API. This is done by validating the JWT that the user sends in the Authorization header of their request.

Clients will authenticate with the following header format:

`Authorization: Bearer <JWT Token>`

**JWT Token Structure**

    1. Header
        - The header contains two parameters:
            - dd-ver: The version of the JWT, set to "DD-JWT-V1".

            - typ: The type of token, set to "JWT".
    2. Payload (Claims):
        - The payload, represented by the claims map, contains the following key-value pairs:
            - iss: The issuer of the token, typically a developer's ID, which should be replaced with the actual **developer ID**.
            - kid: The key ID, which should be replaced with the actual client ID.
            - aud: The audience of the token, set to "Courial".
            - exp: The expiration time in UTC time zone of the token, set to 5 minutes for example (300 seconds) from the current time.
            - iat: The epoch time at which the token was issued, set to the current time.
    3. Signature:
        - The JWT is signed with an HMAC (Hash-based Message Authentication Code) using a secret key.
        - The key is derived from the client secret using Base64 URL decoding.

Provided code is a Java program that generates a JSON Web Token (JWT) using the io.jsonwebtoken library.

```
public class main { 
  public static void main(String[] args) { 
    Map<String, Object> claims = new HashMap<>(); 
    // Replace these constants below with the credentials generated by the Courial
    claims.put("iss", "{developer_id}");
    claims.put("kid", "{client_id}");

    claims.put("aud", "Courial");
    // Set token expiry to be one minute (5 minutes in this case)
    claims.put("exp", ZonedDateTime.now(ZoneOffset.UTC).plusMinutes(5).toEpochSecond());
    claims.put("iat", ZonedDateTime.now(ZoneOffset.UTC).toEpochSecond());

    // Replace these constants below with the credentials generated by the Courial
    byte[] keyBytes = Decoders.BASE64URL.decode("{client _secret}");
    Key key = Keys.hmacShaKeyFor(keyBytes);
    String jwt = Jwts.builder()
            .setHeaderParam("dd-ver", "DD-JWT-V1")
            .setHeaderParam("typ", "JWT")
            .setClaims(claims)
            .signWith(key)
            .compact();

    System.out.println(jwt);
  }
}
```
## Required Endpoints
Endpoint that requires mandatory implementation.
1. [Create Quote](#create-quote)
2. [Create Delivery](#create-delivery)
3. [Cancel Delivery](#cancel-delivery)

[//]: <> (SECTION Create Quote.)
### Create Quote
Confirms that a delivery is serviceable by Courial API and what it would cost by creating a quote. Get a quote on delivery fee and validates coverage.

**Method: POST**

**Url : '/quotes'**

**AUTHORIZATIONS: ***bearerAuth*****

**HTTP: bearerAuth**

**HTTP Authorization Scheme: `bearer`** 

**Bearer format: `JWT`**

### **REQUEST BODY SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Unique ID generated by the caller for the delivery. It must match the regex `[a-zA-Z0-9.-_~]+`. |
| `pickup_address`       | string | Yes      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | Yes       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Dropoff Address Name. Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | Yes       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable.. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `pickup_time`  | string | No       | Time details in ISO-8601 format.        |
| `dropoff_time`  | string | No       |  Time details in ISO-8601 format.        |
| `contactless_dropoff`  | boolean | No       | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off.        |
| `tip`  | integer | No       | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599).        |
| `order_contains`  |  object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles	`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a Driver can use to complete this delivery. The default is 'car'.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
<!-- 
| `action_if_undeliverable`  | string | No       | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'.        |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" <br> Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
 -->

  **`Request samples`**
  
  **`Payload`**
  ```json
    {
      "external_delivery_id": "D-1763",
      "pickup_address": "901 Market Street 6th Floor San Francisco, CA 94103",
      "pickup_business_name": "Wells Fargo SF Downtown",
      "pickup_phone_number": "+16505555555",
      "pickup_instructions": "Go to the bar for pick up.",
      "pickup_external_store_id": "ase-243-dzs",
      "external_business_id": "local_default",
      "dropoff_address": "901 Market Street 6th Floor San Francisco, CA 94103",
      "dropoff_business_name": "The Avery Condominium",
      "dropoff_location": {
        "lat": "123.1312343",
        "lng": "37.2144343"
      },
      "dropoff_phone_number": "+16505555555",
      "dropoff_instructions": "Enter gate code 1234 on the callbox.",
      "dropoff_contact_given_name": "John",
      "dropoff_contact_family_name": "Doe",
      "dropoff_contact_send_notifications": true,
      "dropoff_options": {
        "signature": "required",
        "id_verification": "required",
        "proof_of_delivery": "photo_required"
      },
      "order_value": "1991",
      "items": [
        {
          "name": "Mega Bean and Cheese Burrito",
          "description": "Mega Burrito contains the biggest beans of the land with extra cheese.",
          "quantity": "2",
          "external_id": "123-123443434b",
          "external_instance_id": "12",
          "price": "1000",
          "barcode": "12342830041"
        }
      ],
      "pickup_time": "2018-08-22T17:20:28Z",
      "dropoff_time": "2018-08-22T17:20:28Z",
      "contactless_dropoff": "false",
      "action_if_undeliverable": "return_to_pickup",
      "tip": "599",
      "order_contains": {
        "alcohol": "false"
      },
      "driver_allowed_vehicles": [
        "car",
        "bicycle",
        "walking"
      ],
      "dropoff_requires_signature": "false",
      "dropoff_cash_on_delivery": "1999"
    }
  ```

  #### Responses
  - **200: Ok**

  **RESPONSE SCHEMA: application/json**

  | Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Unique ID generated by the caller for the delivery. It must match the regex `[a-zA-Z0-9.-_~]+`. |
| `pickup_address`       | string | No      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | No       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Dropoff Address Name. Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | Yes       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `currency`  | string | Yes       |  Currency of the order       |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `delivery_status`  | string | Yes       | Enum: "quote" "created" "confirmed" "enroute_to_pickup" "arrived_at_pickup" "picked_up" "enroute_to_dropoff" "arrived_at_dropoff" "delivered" "enroute_to_return" "arrived_at_return" "returned" "cancelled"  During the course of the delivery, the status of the delivery will update to reflect the latest state of the delivery. The status represent the most recent state to be completed.        |
| `cancellation_reason`  | string | No       | Enum: "cancelled_by_creator" "failed_to_process_payment" "failed_to_assign_and_refunded" "failed_to_pickup" "failed_to_deliver" "failed_to_return" The reason why a delivery was cancelled.        |
| `updated_at`  | string | No       | Time when the delivery info was updated in ISO-8601 format.        |
| `pickup_time_estimated`  | string | No       | Estimated time of pickup in ISO-8601 format; null if already picked up.        |
| `pickup_time_actual`  | string | No       | Actual time of pickup in ISO-8601 format; null if not yet picked up.        |
| `dropoff_time_estimated`  | string | No       | Estimated time of drop off in ISO-8601 format; null if already picked up.        |
| `dropoff_time_actual`  | string | No       | Actual time of drop off in ISO-8601 format; null if not yet picked up.       |
| `fee`  | integer | Yes       | Delivery Fee in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `support_reference`  | string | No       | Internal reference for this delivery; reference it when talking or writing to Courial API support.        |
| `dropoff_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was dropped off.        |
| `pickup_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was picked up.        |
| `contactless_dropoff`   | boolean | No  | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off. |
| `tip`   | integer | No  | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599). |
| `order_contains`  | object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a  Driver can use to complete this delivery. The default is 'car'.        |
| `driver_id`  | integer | No       | Unique identifier for the Driver.        |
| `driver_name`  | string | No       | First name and last initial of the Driver delivering the order.        |
| `driver_dropoff_phone_number`  | string | No       | Phone number for the Driver; can only be called from dropoff_phone_number. Should include the country code.       |
| `driver_pickup_phone_number`  | string | No       | Phone number for the Driver; can only be called from pickup_phone_number. Should include the country code.        |
| `driver_location`  | object | No       | Near-real-time location of the Driver.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `driver_vehicle_make`  | string | No       | Make of the Driver's vehicle.        |
| `driver_vehicle_model`  | string | No       | Model of the Driver's vehicle.        |
| `driver_vehicle_year`  | string | No       | Year of the Driver's vehicle.        |
<!--| `dropoff_signature_image_url`  | string | No       | Link to a picture of the dropoff contact's signature that was collected by the Driver during drop off.        | 
| `tracking_url`  | string | No       | Tracking page for the delivery that you can use or share with the sender and/or receiver of the delivery. Note: the URL format is not fixed and may change over time.        |
| `fee_components`  | Array of objects (FeeComponent) | No       | The charges that were applied for this delivery; sums to fee.       |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "drive_fee_component_type_unspecified" "distance_based_fee" "order_value_based_fee" "service_fee" "mx_subsidy" "other" "driver_regulatory_fee" "promotion" "small_order_fee" "flat_fee" "dwt_fee" "unrecognized" Name of the fee component |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the fee component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `tax`  | integer | No       | Delivery tax in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `tax_components`  | Array of objects (TaxComponent) | No       | The taxes that were applied for this delivery; sums to tax.      |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "tax_type_unspecified" "gst_hst" "qst" "pst" "unrecognized" Name of the tax component.|
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the tax component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `action_if_undeliverable`   | string | No  | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'. |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" <br> Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
| `return_time_estimated`  | string | No       | Estimated time of return in ISO-8601 format; null if delivery is not returnable or already returned.        |
| `return_time_actual`  | string | No       | Actual time of return in ISO-8601 format; null if return is not returnable or the return is not yet completed.        |
| `return_address`  | string | No       | If a delivery is being returned-to-pickup, this is the address where the delivery will be returned.        |
| `shipping_label`  | object | No       | The label for a delivery.        |
| &nbsp;&nbsp;↳ `label_format`   | string | No  | Value: 'zpl'. The file format of the label. |
| &nbsp;&nbsp;↳ `label_size`   | string | No  | Value: '4x6'. The size of label. |
| &nbsp;&nbsp;↳ `print_density`   | string | No  | Enum: "203dpi" "300dpi" The printing density of label. |
| &nbsp;&nbsp;↳ `label_string`   | string | No  | A Base64-encoded string of label content. |
| `dropped_items`  | 	Array of objects (DroppedItem) | No       |          |
| &nbsp;&nbsp;↳ `external_id`   | string | Yes  | The Merchant's External ID for the item. |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Value: Enum: "main_item" "substitute_item" Type of the item dropped |
| &nbsp;&nbsp;↳ `reason`   | string | Yes  | Enum: "item_not_found_in_catalog" "item_suspended" "item_not_considered" Reason why the item was dropped |
--> 


- **400: Request Validation Failed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'validation_error' |
| `message` | string | Yes      | One or more request values couldn't be validated. |
| `field_errors` | string | Yes      | Array of objects (FieldError) |
| &nbsp;&nbsp;↳ `field`   | string | Yes  | Name of the field whose value couldn't be validated. |
| &nbsp;&nbsp;↳ `error`   | string | Yes  | The error that was encountered when validating the field's value. |


- **401: Request Unauthorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authentication_error' |
| `message` | string | Yes      | Default: 'The [exp] is in the past; the JWT is expired' |


- **403: Operation Not Authorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authorization_error' |
| `message` | string | Yes      | Default: 'Authorization error: the credentials provided with the request don't work for the requested operation' |


- **409: Duplicate Delivery Id**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'duplicate_delivery_id' |
| `message` | string | Yes      |  |
| `external_delivery_id` | string | Yes      |  /[a-zA-Z0-9-._~]+/ Unique ID generated by the caller for the delivery. |

- **422: Delivery is not Allowed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'invalid_delivery_parameters' |
| `message` | string | Yes      |  |
| `reason` | string | Yes      |   |


- **500: Internal server error.**
 Retry your request. If it still doesn't work, try again later or contact support for assistance.

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'service_fault' |
| `message` | string | Yes      | Default 'Internal service failure, please try again later'. |


[//]: <> (SECTION Create Delivery.)

---------------------------------------------------------------------------------------------------------------------------------------
### Create Delivery
Creates a delivery.

**Method: POST**

**Url : '/deliveries'**



**AUTHORIZATIONS: ***bearerAuth*****

**HTTP: bearerAuth**

**HTTP Authorization Scheme: `bearer`** 

**Bearer format: `JWT`**

**REQUEST BODY SCHEMA: application/json**


### **REQUEST BODY SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Unique ID generated by the caller for the delivery. It must match the regex `[a-zA-Z0-9.-_~]+`. |
| `pickup_address`       | string | Yes      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | Yes       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Dropoff Address Name. Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | Yes       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable.. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `pickup_time`  | string | No       | Time details in ISO-8601 format.        |
| `dropoff_time`  | string | No       |  Time details in ISO-8601 format.        |
| `contactless_dropoff`  | boolean | No       | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off.        |
| `tip`  | integer | No       | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599).        |
| `order_contains`  |  object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles	`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a Driver can use to complete this delivery. The default is 'car'.        |
<!-- 
| `action_if_undeliverable`  | string | No       | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'.        |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" <br> Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
-->

  **`Request samples`**
  
  **`Payload`**
  ```json
  {
    "external_delivery_id": "D-1763",
    "pickup_address": "901 Market Street 6th Floor San Francisco, CA 94103",
    "pickup_business_name": "Wells Fargo SF Downtown",
    "pickup_phone_number": "+16505555555",
    "pickup_instructions": "Go to the bar for pick up.",
    "pickup_external_store_id": "ase-243-dzs",
    "external_business_id": "local_default",
    "dropoff_address": "901 Market Street 6th Floor San Francisco, CA 94103",
    "dropoff_business_name": "The Avery Condominium",
    "dropoff_location": {
      "lat": "123.1312343",
      "lng": "37.2144343"
    },
    "dropoff_phone_number": "+16505555555",
    "dropoff_instructions": "Enter gate code 1234 on the callbox.",
    "dropoff_contact_given_name": "John",
    "dropoff_contact_family_name": "Doe",
    "dropoff_contact_send_notifications": true,
    "dropoff_options": {
      "signature": "required",
      "id_verification": "required",
      "proof_of_delivery": "photo_required"
    },
    "order_value": "1991",
    "items": [
      {
        "name": "Mega Bean and Cheese Burrito",
        "description": "Mega Burrito contains the biggest beans of the land with extra cheese.",
        "quantity": "2",
        "external_id": "123-123443434b",
        "external_instance_id": "12",
        "price": "1000",
        "barcode": "12342830041"
      }
    ],
    "pickup_time": "2018-08-22T17:20:28Z",
    "dropoff_time": "2018-08-22T17:20:28Z",
    "contactless_dropoff": "false",
    "action_if_undeliverable": "return_to_pickup",
    "tip": "599",
    "order_contains": {
      "alcohol": "false"
    },
    "driver_allowed_vehicles": [
      "car",
      "bicycle",
      "walking"
    ],
    "dropoff_requires_signature": "false",
    "dropoff_cash_on_delivery": "1999"
  }
  ```

  #### Responses
  - **201: Created Delivery**

  **RESPONSE SCHEMA: application/json**

  | Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Unique ID generated by the caller for the delivery. It must match the regex `[a-zA-Z0-9.-_~]+`. |
| `pickup_address`       | string | No      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | No       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Dropoff Address Name. Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | No       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `currency`  | string | Yes       |  Currency of the order       |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `delivery_status`  | string | Yes       | Enum: "quote" "created" "confirmed" "enroute_to_pickup" "arrived_at_pickup" "picked_up" "enroute_to_dropoff" "arrived_at_dropoff" "delivered" "enroute_to_return" "arrived_at_return" "returned" "cancelled"  During the course of the delivery, the status of the delivery will update to reflect the latest state of the delivery. The status represent the most recent state to be completed.        |
| `cancellation_reason`  | string | No       | Enum: "cancelled_by_creator" "failed_to_process_payment" "failed_to_assign_and_refunded" "failed_to_pickup" "failed_to_deliver" "failed_to_return" The reason why a delivery was cancelled.        |
| `updated_at`  | string | No       | Time when the delivery info was updated in ISO-8601 format.        |
| `pickup_time_estimated`  | string | No       | Estimated time of pickup in ISO-8601 format; null if already picked up.        |
| `pickup_time_actual`  | string | No       | Actual time of pickup in ISO-8601 format; null if not yet picked up.        |
| `dropoff_time_estimated`  | string | No       | Estimated time of drop off in ISO-8601 format; null if already picked up.        |
| `dropoff_time_actual`  | string | No       | Actual time of drop off in ISO-8601 format; null if not yet picked up.       |
| `fee`  | integer | Yes       | Delivery Fee in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `support_reference`  | string | No       | Internal reference for this delivery; reference it when talking or writing to Courial API support.        |
| `dropoff_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was dropped off.        |
| `pickup_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was picked up.        |
| `contactless_dropoff`   | boolean | No  | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off. |
| `tip`   | integer | No  | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599). |
| `order_contains`  | object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a  Driver can use to complete this delivery. The default is 'car'.        |
| `driver_id`  | integer | No       | Unique identifier for the Driver.        |
| `driver_name`  | string | No       | First name and last initial of the Driver delivering the order.        |
| `driver_dropoff_phone_number`  | string | No       | Phone number for the Driver; can only be called from dropoff_phone_number. Should include the country code.       |
| `driver_pickup_phone_number`  | string | No       | Phone number for the Driver; can only be called from pickup_phone_number. Should include the country code.        |
| `driver_location`  | object | No       | Near-real-time location of the Driver.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `driver_vehicle_make`  | string | No       | Make of the Driver's vehicle.        |
| `driver_vehicle_model`  | string | No       | Model of the Driver's vehicle.        |
| `driver_vehicle_year`  | string | No       | Year of the Driver's vehicle.        |
<!-- | `dropoff_signature_image_url`  | string | No       | Link to a picture of the dropoff contact's signature that was collected by the Driver during drop off.        | 
| `tracking_url`  | string | No       | Tracking page for the delivery that you can use or share with the sender and/or receiver of the delivery. Note: the URL format is not fixed and may change over time.        |
| `fee_components`  | Array of objects (FeeComponent) | No       | The charges that were applied for this delivery; sums to fee.       |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "drive_fee_component_type_unspecified" "distance_based_fee" "order_value_based_fee" "service_fee" "mx_subsidy" "other" "driver_regulatory_fee" "promotion" "small_order_fee" "flat_fee" "dwt_fee" "unrecognized" Name of the fee component. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the fee component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599.|
| `tax`  | integer | No       | Delivery tax in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `tax_components`  | Array of objects (TaxComponent) | No       | The taxes that were applied for this delivery; sums to tax.      |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "tax_type_unspecified" "gst_hst" "qst" "pst" "unrecognized" Name of the tax component. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the tax component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `action_if_undeliverable`   | string | No  | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'. |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
| `return_time_estimated`  | string | No       | Estimated time of return in ISO-8601 format; null if delivery is not returnable or already returned.        |
| `return_time_actual`  | string | No       | Actual time of return in ISO-8601 format; null if return is not returnable or the return is not yet completed.        |
| `return_address`  | string | No       | If a delivery is being returned-to-pickup, this is the address where the delivery will be returned.        |
| `shipping_label`  | object | No       | The label for a delivery.        |
| &nbsp;&nbsp;↳ `label_format`   | string | No  | Value: 'zpl'. The file format of the label. |
| &nbsp;&nbsp;↳ `label_size`   | string | No  | Value: '4x6'. The size of label. |
| &nbsp;&nbsp;↳ `print_density`   | string | No  | Enum: "203dpi" "300dpi" The printing density of label. |
| &nbsp;&nbsp;↳ `label_string`   | string | No  | A Base64-encoded string of label content. |
| `dropped_items`  | 	Array of objects (DroppedItem) | No       |          |
| &nbsp;&nbsp;↳ `external_id`   | string | Yes  | The Merchant's External ID for the item. |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Value: Enum: "main_item" "substitute_item" Type of the item dropped |
| &nbsp;&nbsp;↳ `reason`   | string | Yes  | Enum: "item_not_found_in_catalog" "item_suspended" "item_not_considered" Reason why the item was dropped |
--> 


- **400: Request Validation Failed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'validation_error' |
| `message` | string | Yes      | One or more request values couldn't be validated. |
| `field_errors` | string | Yes      | Array of objects (FieldError) |
| &nbsp;&nbsp;↳ `field`   | string | Yes  | Name of the field whose value couldn't be validated. |
| &nbsp;&nbsp;↳ `error`   | string | Yes  | The error that was encountered when validating the field's value. |


- **401: Request Unauthorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authentication_error' |
| `message` | string | Yes      | Default: 'The [exp] is in the past; the JWT is expired' |


- **403: Operation Not Authorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authorization_error' |
| `message` | string | Yes      | Default: 'Authorization error: the credentials provided with the request don't work for the requested operation' |


- **409: Duplicate Delivery Id**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'duplicate_delivery_id' |
| `message` | string | Yes      |  |
| `external_delivery_id` | string | Yes      |  /[a-zA-Z0-9-._~]+/ Unique ID generated by the caller for the delivery. |

- **422: Delivery is not Allowed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'invalid_delivery_parameters' |
| `message` | string | Yes      |  |
| `reason` | string | Yes      |   |


- **500: Internal server error.**
 Retry your request. If it still doesn't work, try again later or contact support for assistance.

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'service_fault' |
| `message` | string | Yes      | Default 'Internal service failure, please try again later'. |

---------------------------------------------------------------------------------------------------------------------------------------
[//]: <> (SECTION Cancel Delivery.)

### Cancel Delivery
Cancel a delivery. Deliveries can't be cancelled after a Driver is assigned.

**Method: PUT**

**Url : '/deliveries/{external_delivery_id}/cancel'**

**AUTHORIZATIONS: ***bearerAuth*****

**PATH PARAMETERS**
- **external_delivery_id** *(string, required)*  
  Example: D-1763
  Unique (per client) ID of the delivery.

**HTTP: bearerAuth**

**HTTP Authorization Scheme: `bearer`** 

**Bearer format: `JWT`**


| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Example: D-1763 Unique (per client) ID of the delivery. |

  #### Responses
  - **200: Canceled Delivery**

  **RESPONSE SCHEMA: application/json**

  | Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Unique ID generated by the caller for the delivery. It must match the regex `[a-zA-Z0-9.-_~]+`. |
| `pickup_address`       | string | No      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | No       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Dropoff Address Name. Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | No       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `currency`  | string | Yes       |  Currency of the order       |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `delivery_status`  | string | Yes       | Enum: "quote" "created" "confirmed" "enroute_to_pickup" "arrived_at_pickup" "picked_up" "enroute_to_dropoff" "arrived_at_dropoff" "delivered" "enroute_to_return" "arrived_at_return" "returned" "cancelled"  During the course of the delivery, the status of the delivery will update to reflect the latest state of the delivery. The status represent the most recent state to be completed.        |
| `cancellation_reason`  | string | No       | Enum: "cancelled_by_creator" "failed_to_process_payment" "failed_to_assign_and_refunded" "failed_to_pickup" "failed_to_deliver" "failed_to_return" The reason why a delivery was cancelled.        |
| `updated_at`  | string | No       | Time when the delivery info was updated in ISO-8601 format.        |
| `pickup_time_estimated`  | string | No       | Estimated time of pickup in ISO-8601 format; null if already picked up.        |
| `pickup_time_actual`  | string | No       | Actual time of pickup in ISO-8601 format; null if not yet picked up.        |
| `dropoff_time_estimated`  | string | No       | Estimated time of drop off in ISO-8601 format; null if already picked up.        |
| `dropoff_time_actual`  | string | No       | Actual time of drop off in ISO-8601 format; null if not yet picked up.       |
| `fee`  | integer | Yes       | Delivery Fee in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `support_reference`  | string | No       | Internal reference for this delivery; reference it when talking or writing to Courial API support.        |
| `dropoff_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was dropped off.        |
| `pickup_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was picked up.        |
| `contactless_dropoff`   | boolean | No  | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off. |
| `tip`   | integer | No  | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599). |
| `order_contains`  | object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a  Driver can use to complete this delivery. The default is 'car'.        |
| `driver_id`  | integer | No       | Unique identifier for the Driver.        |
| `driver_name`  | string | No       | First name and last initial of the Driver delivering the order.        |
| `driver_dropoff_phone_number`  | string | No       | Phone number for the Driver; can only be called from dropoff_phone_number. Should include the country code.       |
| `driver_pickup_phone_number`  | string | No       | Phone number for the Driver; can only be called from pickup_phone_number. Should include the country code.        |
| `driver_location`  | object | No       | Near-real-time location of the Driver.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `driver_vehicle_make`  | string | No       | Make of the Driver's vehicle.        |
| `driver_vehicle_model`  | string | No       | Model of the Driver's vehicle.        |
| `driver_vehicle_year`  | string | No       | Year of the Driver's vehicle.        |
<!--| `dropoff_signature_image_url`  | string | No       | Link to a picture of the dropoff contact's signature that was collected by the Driver during drop off.        | 
| `tracking_url`  | string | No       | Tracking page for the delivery that you can use or share with the sender and/or receiver of the delivery. Note: the URL format is not fixed and may change over time.        |
| `fee_components`  | Array of objects (FeeComponent) | No       | The charges that were applied for this delivery; sums to fee.       |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "drive_fee_component_type_unspecified" "distance_based_fee" "order_value_based_fee" "service_fee" "mx_subsidy" "other" "driver_regulatory_fee" "promotion" "small_order_fee" "flat_fee" "dwt_fee" "unrecognized" Name of the fee component. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the fee component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `tax`  | integer | No       | Delivery tax in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `tax_components`  | Array of objects (TaxComponent) | No       | The taxes that were applied for this delivery; sums to tax.      |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "tax_type_unspecified" "gst_hst" "qst" "pst" "unrecognized" Name of the tax component.. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the tax component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `action_if_undeliverable`   | string | No  | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'. |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none"  Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
| `return_time_estimated`  | string | No       | Estimated time of return in ISO-8601 format; null if delivery is not returnable or already returned.        |
| `return_time_actual`  | string | No       | Actual time of return in ISO-8601 format; null if return is not returnable or the return is not yet completed.        |
| `return_address`  | string | No       | If a delivery is being returned-to-pickup, this is the address where the delivery will be returned.        |
| `shipping_label`  | object | No       | The label for a delivery.        |
| &nbsp;&nbsp;↳ `label_format`   | string | No  | Value: 'zpl'. The file format of the label. |
| &nbsp;&nbsp;↳ `label_size`   | string | No  | Value: '4x6'. The size of label. |
| &nbsp;&nbsp;↳ `print_density`   | string | No  | Enum: "203dpi" "300dpi" The printing density of label. |
| &nbsp;&nbsp;↳ `label_string`   | string | No  | A Base64-encoded string of label content. |
| `dropped_items`  | 	Array of objects (DroppedItem) | No       |          |
| &nbsp;&nbsp;↳ `external_id`   | string | Yes  | The Merchant's External ID for the item. |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Value: Enum: "main_item" "substitute_item" Type of the item dropped |
| &nbsp;&nbsp;↳ `reason`   | string | Yes  | Enum: "item_not_found_in_catalog" "item_suspended" "item_not_considered" Reason why the item was dropped |
--> 

 **`RESPONSE samples`**
  
  **`Payload`**
  ```json
    {
      "external_delivery_id": "D-1763",
      "pickup_address": "901 Market Street 6th Floor San Francisco, CA 94103",
      "pickup_business_name": "Wells Fargo SF Downtown",
      "pickup_phone_number": "+16505555555",
      "pickup_instructions": "Go to the bar for pick up.",
      "pickup_external_store_id": "ase-243-dzs",
      "external_business_id": "local_default",
      "dropoff_address": "901 Market Street 6th Floor San Francisco, CA 94103",
      "dropoff_business_name": "The Avery Condominium",
      "dropoff_location": {
        "lat": "123.1312343",
        "lng": "37.2144343"
      },
      "dropoff_phone_number": "+16505555555",
      "dropoff_instructions": "Enter gate code 1234 on the callbox.",
      "dropoff_contact_given_name": "John",
      "dropoff_contact_family_name": "Doe",
      "dropoff_contact_send_notifications": true,
      "dropoff_options": {
        "signature": "required",
        "id_verification": "required",
        "proof_of_delivery": "photo_required"
      },
      "order_value": "1991",
      "items": [
        {
          "name": "Mega Bean and Cheese Burrito",
          "description": "Mega Burrito contains the biggest beans of the land with extra cheese.",
          "quantity": "2",
          "external_id": "123-123443434b",
          "external_instance_id": "12",
          "price": "1000",
          "barcode": "12342830041"
        }
      ],
      "pickup_time": "2018-08-22T17:20:28Z",
      "dropoff_time": "2018-08-22T17:20:28Z",
      "contactless_dropoff": "false",
      "action_if_undeliverable": "return_to_pickup",
      "tip": "599",
      "order_contains": {
        "alcohol": "false"
      },
      "driver_allowed_vehicles": [
        "car",
        "bicycle",
        "walking"
      ],
      "dropoff_requires_signature": "false",
      "dropoff_cash_on_delivery": "1999"
    }
  ```


- **400: Request Validation Failed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'validation_error' |
| `message` | string | Yes      | One or more request values couldn't be validated. |
| `field_errors` | string | Yes      | Array of objects (FieldError) |
| &nbsp;&nbsp;↳ `field`   | string | Yes  | Name of the field whose value couldn't be validated. |
| &nbsp;&nbsp;↳ `error`   | string | Yes  | The error that was encountered when validating the field's value. |


- **401: Request Unauthorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authentication_error' |
| `message` | string | Yes      | Default: 'The [exp] is in the past; the JWT is expired' |


- **403: Operation Not Authorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authorization_error' |
| `message` | string | Yes      | Default: 'Authorization error: the credentials provided with the request don't work for the requested operation' |


- **404: Unknown Delivery Id**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'unknown_delivery_id' |
| `message` | string | Yes      |    |
| `external_delivery_id` | string | Yes | /[a-zA-Z0-9-._~]+/ Unique ID generated by the caller for the delivery. |

- **409: Cancel Is Not Allowed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'cancel_not_allowed' |
| `message` | string | Yes      |  |
| `reason` | string | Yes      |  Enum: "delivery_abandoned" "delivery_cancelled" "delivery_completed" "delivery_creation_in_progress" "delivery_picked_up" "cancellation_window_closed" "duplicate_request" |

- **500: Internal server error.**
 Retry your request. If it still doesn't work, try again later or contact support for assistance.

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'service_fault' |
| `message` | string | Yes      | Default 'Internal service failure, please try again later'. |

---------------------------------------------------------------------------------------------------------------------------------------

## Optional Endpoints
Endpoint that can be optionally implemented.
Server can return the code 405 (Method Not Allowed) or 501 (Not Implemented)

1. [Get Delivery](#get-delivery)
2. [Update Delivery](#update-delivery)

[//]: <> (SECTION Get Delivery.)
### Get Delivery

Returns the status and details of a delivery that client created. Client can proactively receive updates about a delivery with webhooks. <link>


**Method: GET**

**Url : '/deliveries/{external_delivery_id}'**


**AUTHORIZATIONS: ***bearerAuth*****

**HTTP: bearerAuth**

**HTTP Authorization Scheme: `bearer`** 

**Bearer format: `JWT`**

**PATH PARAMETERS**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Example: D-1763 Unique (per client) ID of the delivery. |

  #### Responses
  - **200: Delivery**

  **RESPONSE SCHEMA: application/json**

  | Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Unique ID generated by the caller for the delivery. It must match the regex `[a-zA-Z0-9.-_~]+`. |
| `pickup_address`       | string | No      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | No       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Dropoff Address Name. Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | No       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `currency`  | string | Yes       |  Currency of the order       |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `delivery_status`  | string | Yes       | Enum: "quote" "created" "confirmed" "enroute_to_pickup" "arrived_at_pickup" "picked_up" "enroute_to_dropoff" "arrived_at_dropoff" "delivered" "enroute_to_return" "arrived_at_return" "returned" "cancelled"  During the course of the delivery, the status of the delivery will update to reflect the latest state of the delivery. The status represent the most recent state to be completed.        |
| `cancellation_reason`  | string | No       | Enum: "cancelled_by_creator" "failed_to_process_payment" "failed_to_assign_and_refunded" "failed_to_pickup" "failed_to_deliver" "failed_to_return" The reason why a delivery was cancelled.        |
| `updated_at`  | string | No       | Time when the delivery info was updated in ISO-8601 format.        |
| `pickup_time_estimated`  | string | No       | Estimated time of pickup in ISO-8601 format; null if already picked up.        |
| `pickup_time_actual`  | string | No       | Actual time of pickup in ISO-8601 format; null if not yet picked up.        |
| `dropoff_time_estimated`  | string | No       | Estimated time of drop off in ISO-8601 format; null if already picked up.        |
| `dropoff_time_actual`  | string | No       | Actual time of drop off in ISO-8601 format; null if not yet picked up.       |
| `fee`  | integer | Yes       | Delivery Fee in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `support_reference`  | string | No       | Internal reference for this delivery; reference it when talking or writing to Courial API support.        |
| `dropoff_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was dropped off.        |
| `pickup_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was picked up.        |
| `contactless_dropoff`   | boolean | No  | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off. |
| `tip`   | integer | No  | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599). |
| `order_contains`  | object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a  Driver can use to complete this delivery. The default is 'car'.        |
| `driver_id`  | integer | No       | Unique identifier for the Driver.        |
| `driver_name`  | string | No       | First name and last initial of the Driver delivering the order.        |
| `driver_dropoff_phone_number`  | string | No       | Phone number for the Driver; can only be called from dropoff_phone_number. Should include the country code.       |
| `driver_pickup_phone_number`  | string | No       | Phone number for the Driver; can only be called from pickup_phone_number. Should include the country code.        |
| `driver_location`  | object | No       | Near-real-time location of the Driver.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `driver_vehicle_make`  | string | No       | Make of the Driver's vehicle.        |
| `driver_vehicle_model`  | string | No       | Model of the Driver's vehicle.        |
| `driver_vehicle_year`  | string | No       | Year of the Driver's vehicle.        |
<!-- | `dropoff_signature_image_url`  | string | No       | Link to a picture of the dropoff contact's signature that was collected by the Driver during drop off.        | 
| `tracking_url`  | string | No       | Tracking page for the delivery that you can use or share with the sender and/or receiver of the delivery. Note: the URL format is not fixed and may change over time.        |
| `fee_components`  | Array of objects (FeeComponent) | No       | The charges that were applied for this delivery; sums to fee.       |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "drive_fee_component_type_unspecified" "distance_based_fee" "order_value_based_fee" "service_fee" "mx_subsidy" "other" "driver_regulatory_fee" "promotion" "small_order_fee" "flat_fee" "dwt_fee" "unrecognized" Name of the fee component. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the fee component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `tax`  | integer | No       | Delivery tax in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `tax_components`  | Array of objects (TaxComponent) | No       | The taxes that were applied for this delivery; sums to tax.      |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "tax_type_unspecified" "gst_hst" "qst" "pst" "unrecognized" Name of the tax component. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the tax component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `action_if_undeliverable`   | string | No  | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'. |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
| `return_time_estimated`  | string | No       | Estimated time of return in ISO-8601 format; null if delivery is not returnable or already returned.        |
| `return_time_actual`  | string | No       | Actual time of return in ISO-8601 format; null if return is not returnable or the return is not yet completed.        |
| `return_address`  | string | No       | If a delivery is being returned-to-pickup, this is the address where the delivery will be returned.        |
| `shipping_label`  | object | No       | The label for a delivery.        |
| &nbsp;&nbsp;↳ `label_format`   | string | No  | Value: 'zpl'. The file format of the label. |
| &nbsp;&nbsp;↳ `label_size`   | string | No  | Value: '4x6'. The size of label. |
| &nbsp;&nbsp;↳ `print_density`   | string | No  | Enum: "203dpi" "300dpi" The printing density of label. |
| &nbsp;&nbsp;↳ `label_string`   | string | No  | A Base64-encoded string of label content. |
| `dropped_items`  | 	Array of objects (DroppedItem) | No       |          |
| &nbsp;&nbsp;↳ `external_id`   | string | Yes  | The Merchant's External ID for the item. |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Value: Enum: "main_item" "substitute_item" Type of the item dropped |
| &nbsp;&nbsp;↳ `reason`   | string | Yes  | Enum: "item_not_found_in_catalog" "item_suspended" "item_not_considered" Reason why the item was dropped |
-->


- **400: Request Validation Failed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'validation_error' |
| `message` | string | Yes      | One or more request values couldn't be validated. |
| `field_errors` | string | Yes      | Array of objects (FieldError) |
| &nbsp;&nbsp;↳ `field`   | string | Yes  | Name of the field whose value couldn't be validated. |
| &nbsp;&nbsp;↳ `error`   | string | Yes  | The error that was encountered when validating the field's value. |


- **401: Request Unauthorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authentication_error' |
| `message` | string | Yes      | Default: 'The [exp] is in the past; the JWT is expired' |


- **403: Operation Not Authorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authorization_error' |
| `message` | string | Yes      | Default: 'Authorization error: the credentials provided with the request don't work for the requested operation' |


- **404: Unknown Delivery Id**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'unknown_delivery_id' |
| `message` | string | Yes      |    |
| `external_delivery_id` | string | Yes | /[a-zA-Z0-9-._~]+/ Unique ID generated by the caller for the delivery. |

- **409: Cancel Is Not Allowed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'cancel_not_allowed' |
| `message` | string | Yes      |  |
| `reason` | string | Yes      |  Enum: "delivery_abandoned" "delivery_cancelled" "delivery_completed" "delivery_creation_in_progress" "delivery_picked_up" "cancellation_window_closed" "duplicate_request" |

- **500: Internal server error.**
 Retry your request. If it still doesn't work, try again later or contact support for assistance.

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'service_fault' |
| `message` | string | Yes      | Default 'Internal service failure, please try again later'. |


---------------------------------------------------------------------------------------------------------------------------------------


[//]: <> (SECTION UPDATE DELIVERY.)

### Update Delivery

Update the details of a delivery. Only the fields listed below can be updated; to update other fields, you need to cancel the delivery and then create a new one.


**Method: PATCH**

**Url : '/deliveries/{external_delivery_id}'**


**AUTHORIZATIONS: ***bearerAuth*****

**HTTP: bearerAuth**

**HTTP Authorization Scheme: `bearer`** 

**Bearer format: `JWT`**

**PATH PARAMETERS**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id` | string | Yes      | Example: D-1763 Unique (per client) ID of the delivery. |

### **REQUEST BODY SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `pickup_address`       | string | No      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | No       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Optional name of the place, to help Drivers find the location.       |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | Yes       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `contactless_dropoff`  | boolean | No       | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off.        |
| `tip`  | integer | No       | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599).        |
| `order_contains`  |  object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a Driver can use to complete this delivery. The default is 'car'.        |
| `order_value`  | integer | No       | The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | No  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | No  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable.. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `pickup_time`  | string | No       | Time details in ISO-8601 format.        |
| `dropoff_time`  | string | No       |  Time details in ISO-8601 format.        |
<!-- 
| `action_if_undeliverable`  | string | No       | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'.        |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
-->


  **`Request samples`**
  
  **`Payload`**
  ```json
    {
      "pickup_address": "string",
      "pickup_business_name": "string",
      "pickup_phone_number": "string",
      "pickup_instructions": "string",
      "pickup_external_store_id": "ase-243-dzs",
      "external_business_id": "local_default",
      "dropoff_address": "string",
      "dropoff_business_name": "string",
      "dropoff_location": {
        "lat": 0,
        "lng": 0
      },
      "dropoff_phone_number": "string",
      "dropoff_instructions": "Enter gate code 1234 on the callbox.",
      "dropoff_contact_given_name": "John",
      "dropoff_contact_family_name": "Doe",
      "dropoff_contact_send_notifications": true,
      "dropoff_options": {
        "signature": "required",
        "id_verification": "required",
        "proof_of_delivery": "photo_required"
      },
      "contactless_dropoff": true,
      "action_if_undeliverable": "return_to_pickup",
      "tip": "599",
      "order_contains": {
        "alcohol": "false"
      },
      "driver_allowed_vehicles": [
        "car",
        "bicycle",
        "walking"
      ],
      "dropoff_requires_signature": true,
      "dropoff_cash_on_delivery": "1999",
      "order_value": "1999",
      "items": [
        {
          "name": "Mega Bean and Cheese Burrito",
          "description": "Mega Burrito contains the biggest beans of the land with extra cheese.",
          "quantity": "2",
          "external_id": "123-123443434b",
          "external_instance_id": "12",
          "price": "1000",
          "barcode": "12342830041"
        }
      ],
      "pickup_time": "2018-08-22T17:20:28Z",
      "dropoff_time": "2018-08-22T17:20:28Z"
    }
  ```


  #### Responses
  - **200: Updated Delivery**

  **RESPONSE SCHEMA: application/json**

  | Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `external_delivery_id`       | string | Yes      | /[a-zA-Z0-9-._~]+/ Unique ID generated by the caller for the delivery.              |
| `pickup_address`       | string | No      | Comma-separated full address, in the order appropriate for your locale.                 |
| `pickup_business_name` | string | No       | Optional name of the place to help drivers find the location.                           |
| `pickup_phone_number`  | string | No       | The phone number for the driver to call if there are any issues with the pickup. Should include the country code and must match the country of the store for which the delivery is created. Must adhere to E.164 international phone number standard.        |
| `pickup_instructions`  | string | No       | Instructions for the Driver to follow when picking up the order. |
| `pickup_external_store_id`  | string | No       | Unique ID of the store.        |
| `external_business_id`  | string | No       | Unique ID of the business that initiates a request. Should be used for billing purposes.        |
| `dropoff_address`  | string | No       | Comma-separated full address, in the order appropriate for your locale.       |
| `dropoff_business_name`  | string | No       | Optional name of the place, to help Drivers find the location.      |
| `dropoff_location`  | object | No       | The precise location, as latitude and longitude, of the drop-off. If request includes both location and address, location must be used for Driver navigation only; address must be used for fee and serviceability checks.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `dropoff_phone_number`  | string | No       | Drop-off Phone number. The phone number for the Driver to call if there are any issues with the delivery. Should include the country code. Must adhere to E.164 international phone number standard.        |
| `dropoff_instructions	`  | string | No       | Instructions for the Driver to follow when picking up the order.        |
| `dropoff_contact_given_name`  | string | No       | Given/first name of the contact.        |
| `dropoff_contact_family_name`  | string | No       | Family/last name of the contact.        |
| `dropoff_contact_send_notifications`  | boolean | No       | Whether the notifications should be sent to contact by Courial for this delivery. The default is false.        |
| `order_value` | integer | No |  The subtotal for all items in the order, excluding tax/tip, in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999. |
| `currency` | string | Yes | Currency of the order |
| `items`  | Array of objects (DeliveryItem) | No       |  Array of following items       |
| &nbsp;&nbsp;↳ `name`   | string | Yes  | Name of the item being delivered. |
| &nbsp;&nbsp;↳ `description`   | string | No  | Description of the item being delivered. |
| &nbsp;&nbsp;↳ `quantity`   | integer | Yes  | Quantity of the item being delivered. |
| &nbsp;&nbsp;↳ `external_id`   | string | No  | Unique ID generated by the caller for the item. |
| &nbsp;&nbsp;↳ `external_instance_id`   | string | No  | Used to distinguish between multiple items with the same external_id, such as for 2 steaks in the same order with separate weights. Not updatable.. |
| &nbsp;&nbsp;↳ `price`   | integer | No  | Unit price of 1 instance of this item in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. The overall price of this item is calculated by multiplying this field by quantity. |
| &nbsp;&nbsp;↳ `barcode`   | string | No  | Barcode identifying the item. This value must be in one of the following formats: Data Matrix, AZTEC, Code 128, Code 39, Code 93, CODABAR, EAN 13, EAN 8, ITF, UPC A, UPC E, PDF417. Not updatable. |
| `delivery_status` | string | Yes | Enum: "quote" "created" "confirmed" "enroute_to_pickup" "arrived_at_pickup" "picked_up" "enroute_to_dropoff" "arrived_at_dropoff" "delivered" "enroute_to_return" "arrived_at_return" "returned" "cancelled" During the course of the delivery, the status of the delivery will update to reflect the latest state of the delivery. The status represent the most recent state to be completed. |
| `cancellation_reason` | string | No | Enum: "cancelled_by_creator" "failed_to_process_payment" "failed_to_assign_and_refunded" "failed_to_pickup" "failed_to_deliver" "failed_to_return" The reason why a delivery was cancelled. |  
| `updated_at` | string | No | Time when the delivery info was updated in ISO-8601 format.  |
| `pickup_time_estimated`  | string | No | Estimated time of pickup in ISO-8601 format; null if already picked up. |
| `pickup_time_actual`  | string | No |  Actual time of pickup in ISO-8601 format; null if not yet picked up. |
| `dropoff_time_estimated`  | string | No | Estimated time of drop off in ISO-8601 format; null if already picked up. |
| `dropoff_time_actual`  | string | No | Actual time of drop off in ISO-8601 format; null if not yet picked up. |
| `fee`  | integer | Yes       | Delivery Fee in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `support_reference`  | string | No       | Internal reference for this delivery; reference it when talking or writing to Courial API support.        |
| `dropoff_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was dropped off.        |
| `pickup_verification_image_url`  | string | No       | Link to the picture taken by the Driver to indicate where the order was picked up.        |
| `contactless_dropoff`   | boolean | No  | Whether the delivery should be contactless, which prompts a Driver to take a picture of the delivery at drop-off. |
| `tip`   | integer | No  | The tip amount. Use cents or the equivalent lowest currency denomination (e.g. $5.99 = 599). |
| `order_contains`  | object (OrderContains) | No       | An object that specifies the restricted item(s) contained in this order.        |
| &nbsp;&nbsp;↳ `alcohol`   | boolean | No  | Flag to specify if the delivery contains alcohol. |
| `driver_allowed_vehicles`  | Array of strings | No       | Items Enum: 'car', 'bicycle', 'walking'. The vehicle type(s) that a  Driver can use to complete this delivery. The default is 'car'.        |
| `driver_id`  | integer | No       | Unique identifier for the Driver.        |
| `driver_name`  | string | No       | First name and last initial of the Driver delivering the order.        |
| `driver_dropoff_phone_number`  | string | No       | Phone number for the Driver; can only be called from dropoff_phone_number. Should include the country code.       |
| `driver_pickup_phone_number`  | string | No       | Phone number for the Driver; can only be called from pickup_phone_number. Should include the country code.        |
| `driver_location`  | object | No       | Near-real-time location of the Driver.        |
| &nbsp;&nbsp;↳ `lat`   | number | Yes  | Latitude of the location. |
| &nbsp;&nbsp;↳ `lng`   | number | Yes  | Longitude of the location. |
| `driver_vehicle_make`  | string | No       | Make of the Driver's vehicle.        |
| `driver_vehicle_model`  | string | No       | Model of the Driver's vehicle.        |
| `driver_vehicle_year`  | string | No       | Year of the Driver's vehicle.        |
<!-- | `dropoff_signature_image_url`  | string | No       | Link to a picture of the dropoff contact's signature that was collected by the Driver during drop off.        | 
| `tracking_url`  | string | No       | Tracking page for the delivery that you can use or share with the sender and/or receiver of the delivery. Note: the URL format is not fixed and may change over time.        |
| `fee_components`  | Array of objects (FeeComponent) | No       | The charges that were applied for this delivery; sums to fee.       |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "drive_fee_component_type_unspecified" "distance_based_fee" "order_value_based_fee" "service_fee" "mx_subsidy" "other" "driver_regulatory_fee" "promotion" "small_order_fee" "flat_fee" "dwt_fee" "unrecognized" Name of the fee component. |
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the fee component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `tax`  | integer | No       | Delivery tax in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599 or null if not available.        |
| `tax_components`  | Array of objects (TaxComponent) | No       | The taxes that were applied for this delivery; sums to tax.      |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Enum: "tax_type_unspecified" "gst_hst" "qst" "pst" "unrecognized" Name of the tax component.|
| &nbsp;&nbsp;↳ `amount`   | integer | Yes  | Amount of the tax component in the lowest currency denomination (e.g. cents). i.e. $5.99 = 599. |
| `action_if_undeliverable`   | string | No  | Enum: "return_to_pickup" "dispose" What the Driver should do if the delivery is undeliverable. The default is 'dispose'. |
| `dropoff_requires_signature`  | boolean | No       | Whether the delivery requires signature verification during drop-off.        |
| `dropoff_cash_on_delivery`  | integer | No       | The cash to collect when this order is dropped off, value in the lowest currency denomination (e.g. cents). i.e. $19.99 = 1999.        |
| `dropoff_options`  | object | No       | Additional options for drop off.        |
| &nbsp;&nbsp;↳ `signature`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if the delivery requires signature verification during drop off. Not updatable. |
| &nbsp;&nbsp;↳ `id_verification`   | string | No  | Enum: "required" "preferred" "none" Flag to specify if ID verification is required at drop-off. If order contains alcohol, this field needs to be set to 'required'. Not updatable. |
| &nbsp;&nbsp;↳ `proof_of_delivery`   | string | No  | Enum: "photo_required" "photo_preferred" "pin_code" "none" Flag to specify if the delivery requires proof of delivery during drop off. Not updatable. |
| `return_time_estimated`  | string | No | Estimated time of return in ISO-8601 format; null if delivery is not returnable or already returned. |
| `return_time_actual`  | string | No | Actual time of return in ISO-8601 format; null if return is not returnable or the return is not yet completed. |
| `return_address`  | string | No | If a delivery is being returned-to-pickup, this is the address where the delivery will be returned.  |
| `shipping_label`  | object | No       | The label for a delivery.        |
| &nbsp;&nbsp;↳ `label_format`   | string | No  | Value: 'zpl'. The file format of the label. |
| &nbsp;&nbsp;↳ `label_size`   | string | No  | Value: '4x6'. The size of label. |
| &nbsp;&nbsp;↳ `print_density`   | string | No  | Enum: "203dpi" "300dpi" The printing density of label. |
| &nbsp;&nbsp;↳ `label_string`   | string | No  | A Base64-encoded string of label content. |
| `dropped_items`  | 	Array of objects (DroppedItem) | No       |          |
| &nbsp;&nbsp;↳ `external_id`   | string | Yes  | The Merchant's External ID for the item. |
| &nbsp;&nbsp;↳ `type`   | string | Yes  | Value: Enum: "main_item" "substitute_item" Type of the item dropped |
| &nbsp;&nbsp;↳ `reason`   | string | Yes  | Enum: "item_not_found_in_catalog" "item_suspended" "item_not_considered" Reason why the item was dropped |
-->


**`Response samples`**
  
  **`Payload`**
  ```json
    {
      "pickup_address": "string",
      "pickup_business_name": "string",
      "pickup_phone_number": "string",
      "pickup_instructions": "string",
      "pickup_external_store_id": "ase-243-dzs",
      "external_business_id": "local_default",
      "dropoff_address": "string",
      "dropoff_business_name": "string",
      "dropoff_location": {
        "lat": 0,
        "lng": 0
      },
      "dropoff_phone_number": "string",
      "dropoff_instructions": "Enter gate code 1234 on the callbox.",
      "dropoff_contact_given_name": "John",
      "dropoff_contact_family_name": "Doe",
      "dropoff_contact_send_notifications": true,
      "dropoff_options": {
        "signature": "required",
        "id_verification": "required",
        "proof_of_delivery": "photo_required"
      },
      "contactless_dropoff": true,
      "action_if_undeliverable": "return_to_pickup",
      "tip": "599",
      "order_contains": {
        "alcohol": "false"
      },
      "driver_allowed_vehicles": [
        "car",
        "bicycle",
        "walking"
      ],
      "dropoff_requires_signature": true,
      "dropoff_cash_on_delivery": "1999",
      "order_value": "1999",
      "items": [
        {
          "name": "Mega Bean and Cheese Burrito",
          "description": "Mega Burrito contains the biggest beans of the land with extra cheese.",
          "quantity": "2",
          "external_id": "123-123443434b",
          "external_instance_id": "12",
          "price": "1000",
          "barcode": "12342830041"
        }
      ],
      "pickup_time": "2018-08-22T17:20:28Z",
      "dropoff_time": "2018-08-22T17:20:28Z"
    }
  ```


- **400: Request Validation Failed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'validation_error' |
| `message` | string | Yes      | One or more request values couldn't be validated. |
| `field_errors` | string | Yes      | Array of objects (FieldError) |
| &nbsp;&nbsp;↳ `field`   | string | Yes  | Name of the field whose value couldn't be validated. |
| &nbsp;&nbsp;↳ `error`   | string | Yes  | The error that was encountered when validating the field's value. |


- **401: Request Unauthorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authentication_error' |
| `message` | string | Yes      | Default: 'The [exp] is in the past; the JWT is expired' |


- **403: Operation Not Authorized**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Default: 'authorization_error' |
| `message` | string | Yes      | Default: 'Authorization error: the credentials provided with the request don't work for the requested operation' |


- **404: Unknown Delivery Id**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'unknown_delivery_id' |
| `message` | string | Yes      |    |
| `external_delivery_id` | string | Yes | /[a-zA-Z0-9-._~]+/ Unique ID generated by the caller for the delivery. |

- **409: Update Is Not Allowed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'cancel_not_allowed' |
| `message` | string | Yes      |  |
| `reason` | string | Yes      |  Enum: "delivery_cancelled" "delivery_completed" "delivery_creation_in_progress" "delivery_picked_up" "delivery_abandoned" "update_window_closed" |


- **422: Delivery is not Allowed**

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'invalid_delivery_parameters' |
| `message` | string | Yes      |  |
| `reason` | string | Yes      |    |

- **500: Internal server error.**
 Retry your request. If it still doesn't work, try again later or contact support for assistance.

  **RESPONSE SCHEMA: application/json**

| Field                  | Type   | Required | Description                                                                             |
|------------------------|--------|----------|-----------------------------------------------------------------------------------------|
| `code` | string | Yes      | Value: 'service_fault' |
| `message` | string | Yes      | Default 'Internal service failure, please try again later'. |



## API Webhooks (1.0.0)

### Courial API Webhooks
Client should be able to receive updates about a delivery by subscribing to webhooks.
The Courial API should send delivery updates to the client as a REST payload.
The client's app will provide an internet-accessible REST endpoint that will receive and process the webhooks as payload in `text/plain` format.
Webhooks enable near-real-time information flow from Courial API and Drivers to client application and client customers.
With webhooks, your clients can enable real-time scenarios like a map view showing their customers how far away their Drivers are, push notifications telling client customers the latest status of their order, and much more.


### Secured Webhook Endpoint
The endpoint that will receive API webhooks must be an HTTPS endpoint and should be protected with authentication.
Client API should send webhooks protected by Basic Authentication.
The client will provide the contents that API should send in the HTTP Authorization header when sending webhooks.

### List of Webhook Events

#### **All Deliveries**
API should send webhooks for the following events, as soon as the event takes place:

- **DRIVER_CONFIRMED**: A Driver has accepted your delivery and is on the way to the pickup location.
- **DRIVER_CONFIRMED_PICKUP_ARRIVAL**: The Driver has confirmed that they arrived at the pickup location and are attempting to pick up the delivery.
- **DRIVER_PICKED_UP**: The Driver has picked up the delivery.
- **DRIVER_CONFIRMED_DROPOFF_ARRIVAL**: The Driver has confirmed that they arrived at the dropoff location.
- **DRIVER_DROPPED_OFF**: The Driver has dropped off the delivery at the dropoff location, and the delivery is complete.
- **DELIVERY_CANCELLED**: The delivery has been canceled.


<!-- #### **Return-to-Pickup Deliveries Only**
Deliveries that can be returned-to-pickup may generate webhooks for the following events:
- **DELIVERY_RETURN_INITIALIZED**: The Driver was unable to deliver your delivery to the dropoff location; they contacted support to arrange a return-to-pickup delivery and are returning to the pickup location.
- **DRIVER_CONFIRMED_RETURN_ARRIVAL**: The Driver has confirmed that they arrived at the pickup location and are attempting to return the delivery.
- **DELIVERY_RETURNED**: The delivery has been returned successfully.
- **DELIVERY_CANCELLED (with reason = failed_to_return)**: The delivery was unable to be returned.
-->

#### **Delivery Tracking**
Courial API can also provide various driver_enroute webhooks that send the location of the Driver every N seconds/minutes.

- **DRIVER_ENROUTE_TO_PICKUP**: The Driver is on their way to pick up the delivery.
- **DRIVER_ENROUTE_TO_DROPOFF**: The Driver is on their way to the dropoff location.
<!-- - **DRIVER_ENROUTE_TO_RETURN**: The Driver is on their way back to the pickup location to return the items. -->

### Fields

Webhooks contain all of the details about a delivery that are available when the webhook is sent. If a field is empty or not available, the field is not sent in the webhook body. For example, `pickup_time_actual` is not included in webhook payloads until the delivery has been picked up by the Driver. Client code should always check if a field is present before accessing it.



| Field                   | Description | Applicable Events                                                                             |
|------------------------ | ----------|-----------------------------------------------------------------------------------------|
| `cancellation_reason` | Why the order was canceled	 | Only the `DELIVERY_CANCELLED` event   |
| `cancellation_reason_message` | Why the order was canceled, in the Driver's words	 |  Only the DELIVERY_CANCELLED event and only if cancellation_reason = failed_to_return |
| `contactless` | Whether the delivery was contactless or normal	 | All events |
| `created_at` | When the webhook was created	 | All events |
| `currency` | The currency of `order_value`, `fee`, and `tip` in cents	 | All events |
| `driver_id` | The unique identifier for the Driver	 | All events |
| `driver_name` | The first name and last initial of the Driver	 | All events |
| `driver_dropoff_phone_number` | The phone number of the Driver for the dropoff contact to use	 | All events |
| `driver_pickup_phone_number` | The phone number of the Driver for the pickup contact to use	 | All events |
| `driver_location` | Latitude and longitude of the Driver	 | All events |
| `driver_vehicle_make` | Make of the Driver's vehicle	 | All events |
| `driver_vehicle_model` | Model of the Driver's vehicle	 | All events |
| `driver_vehicle_year` | Year of the Driver's vehicle	 | All events |
| `dropoff_address` | Where the delivery will be dropped off | All events |
| `dropoff_contact_family_name` | Family name of the contact	 | All events |
| `dropoff_contact_given_name` | Given name of the contact	 | All events |
| `dropoff_contact_send_notifications` | Whether the contact will receive notifications from Courial API for this delivery; default is false | All events |
| `dropoff_instructions` | Instructions for the Driver to follow when dropping off the order	 | All events |
| `dropoff_phone_number` | The phone number for the Driver to call in case of problems with pickup	 | All events |
| `dropoff_time_actual` | When the delivery was dropped off	 | All events after and including `DRIVER_DROPPED_OFF` |
| `dropoff_time_estimated` | When the delivery is estimated to be dropped off | All events |
| `dropoff_verification_image_url` | The verification image taken by the Driver when the order was dropped off	 | All events |
<!--| `dropoff_signature_image_url` | The signature image obtained from the customer when the order was dropped off if applicable | All events | -->


### Cancellation Reasons
Cancellation reasons client may receive in webhook.
| Reason  | Reason Comments | 
|-------- | --------------- |
| cancel_by_dispatch |	Order was cancelled by Courial support |
| cancel_by_merchant |	The order was cancelled by the merchant |
| cancel_by_order_placer |	The order was cancelled by the person that created it |
| customer_requested | The customer cancelled the order |
| driver_cannot_fulfill |	The Driver couldn't fulfill the order |
| driver_not_responding |	The Driver was not responding |
| drive_order_picked_up_by_customer |	The order was picked up by the customer |
| duplicate_order |	The order is a duplicate of another order |
| fraudulent_order | Courial suspects this order is fraudulent |
| items_temporarily_unavailable |	Items were temporarily unavailable |
| no_available_drivers |	No Drivers are available for this order |
| nontablet_protocol_issue |	Courial didn't receive the full order |
| other |	Courial encountered an unknown error |
| picked_up_by_other_driver |	Order was picked up by another Driver |
| store_cannot_fulfill |	The store couldn't fulfill the order |
| store_closed |	The store is not available at the time the order is requested or was closed when the Driver arrived |
| test_order |	The order was a test order and was cancelled by a clean-up job |
| too_busy |	The restaurant is too busy |
| too_late |	The order was taking too long |
| wrong_delivery_address |	The delivery address was incorrect |


### Data Formats
All ...*time*... fields are sent as ISO-8601 date and times and are therefore sent in the UTC time zone.

### Errors
- **401 Unauthorized**: If the external_delivery_id is invalid or the Authorization header is incorrect.
- **400 Bad Request**: If the request contains invalid data or is missing required fields.

### Webhook Example
Courial API should authenticate with the following header format:

`Authorization: <Auth Content from Client>`

Webhook Payload (POST request):

```
{
  "created_at": "2022-02-01T23:18:22.791883Z",
  "event_name": "DRIVER_DROPPED_OFF",
  "external_delivery_id": "c19a5d37-e457-4247-9a67-921ec0134125",
  "driver_id": 123212,
  "driver_name": "John D.",
  "driver_dropoff_phone_number": "+16504379788",
  "driver_pickup_phone_number": "+16504379799",
  "driver_location": {"lat": 43.333333333, "lng": -79.333333333},
  "driver_vehicle_make": "Honda",
  "driver_vehicle_model": "Civic",
  "driver_vehicle_year": "2003",
  "pickup_address": "1000 4th Avenue, Seattle, WA 98104",
  "pickup_phone_number": "+1(855)9731040",
  "pickup_instructions": "please take it to floor 21",
  "pickup_external_store_id": "ase-243-dzs",
  "external_business_id": "local_default",
  "dropoff_address": "1201 3rd Avenue, Seattle, WA 98101",
  "dropoff_phone_number": "+1(855)9731040",
  "dropoff_instructions": "please take it to floor 21",
  "dropoff_contact_given_name": "John",
  "dropoff_contact_family_name": "Doe",
  "dropoff_contact_send_notifications": true,
  "order_value": 5555,
  "currency": "USD",
  "updated_at": "2022-02-01T23:18:22.791883Z",
  "pickup_time_estimated": "2022-02-01T23:32:06.000000Z",
  "pickup_time_actual": "2022-02-01T23:17:20.521249Z",
  "dropoff_time_estimated": "2022-02-01T23:56:06.000000Z",
  "dropoff_time_actual": "2022-02-01T23:18:22.541773Z",
  "fee": 975,
  "tip": 230,
  "support_reference": "1343593362",
  "contactless": false
}
```


